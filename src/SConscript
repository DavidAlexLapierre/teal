import os

# Getting the different files
def generate_cpp_paths(folder):
    cpp_paths = []

    def explore_directory(current_path, relative_path=""):
        nonlocal cpp_paths

        for item in os.listdir(current_path):
            item_path = os.path.join(current_path, item)

            if os.path.isdir(item_path):
                new_relative_path = os.path.join(relative_path, item)
                cpp_paths.append(os.path.join(".", new_relative_path, '*.cpp'))
                explore_directory(item_path, new_relative_path)

    explore_directory(folder)
    return cpp_paths


env = Environment(tools=['mingw'], SCONS_CXX_STANDARD='c++20')

cpp_files = generate_cpp_paths("..\\src")
cpp_files.append(".\\*.cpp")

src_files = []

for path in cpp_files:
    src_files.append(Glob(path))

# Adding glad.c
src_files.append('..\\src\\glad.c')

# Build parameters
env.Append( CPPPATH=[
        '..\\src',
        '..\\libs\\includes'
] )

env.Append( CPPDEFINES=['WINDOWS'] )
env.Append( LIBPATH=['..\\libs'] )
env.Append( LIBS=[
    'glfw3',
    'opengl32',
    'User32',
    'Gdi32',
    'Shell32'
] )

ccflags = []

debug = ARGUMENTS.get('debug', 0)
if int(debug):
    ccflags.append('-g')

env.Append( CCFLAGS=ccflags)

# compile_commands.json for NVIM environment
env.Tool('compilation_db')
env.CompilationDatabase()

# build program
env.Program('teal', src_files)
